<!DOCTYPE html>
<html>
	<head>
		<title>Gantt Chart Creator - Single Input</title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="./css/font-awesome.min.css">
		<link rel="stylesheet" href="./css/css.css">
		<link rel="stylesheet" href="./css/unsemantic.css">
		<link rel="stylesheet" href="./css/common.css">
		<link rel="stylesheet" href="./css/demo.css">
		<link rel="stylesheet" href="./css/vis.css">
		<script src="./js/jquery.min.js"></script>
		<script src="./js/papaparse.js"></script>
		<script src="./js/vis.js"></script>
	</head>
	<body>
		<br>
		<h1>Gantt Chart Creator</h1>
		<div class="grid-container">

					<div class="grid-65 text-center">
					TASKS: <textarea id="input" placeholder="Input">id,content,group,start,end,type,className
1,Task 1,Common,2016-12-02,2017-03-17,point,redpoint
2,Task 2,Common,2016-12-02,,box,green
3,Task 3,Common,2016-12-02,2017-03-17,range,blue
4,<br><br><br><br><br><br><br>Background spanning <br>across all groups,,2016-12-02,2017-02-17,background,
5,Group Specific background,Section 1,2017-03-17,2017-05-07,background,
6,Task 6,Common,2017-03-17,2017-04-27,range,red
7,Task 7,Section 2,2017-04-07,2017-04-27,box,orange
8,Task 8,Section 2,2017-05-07,2017-05-17,box,green
9,Overflow for Task 9,Section 3,2017-06-07,2017-06-20,range,blueoverflow
10,Task 10,Section 3,2017-07-07,2017-07-31,point,orangepoint</textarea>
					</div>
					<div class="grid-35 text-center">
					Custom CSS:
					<textarea id="custom_css">.vis-item.redpoint {
border-color: darkred;
}

.vis-item.blueoverflow .vis-item-overflow {
color: darkgrey;
background-color: blue;
border-color: darkblue;
overflow: visible;
}
.vis-item.red {
color: white;
background-color: red;
border-color: darkred;
}

.vis-item.green {
color: white;
background-color: green;
border-color: darkgreen;
}

.vis-item.blue {
color: white;
background-color: blue;
border-color: darkblue;
}

.vis-item.orange {
color: white;
background-color: orange;
border-color: darkorange;
}
.vis-item.orangepoint {
border-color: darkorange;
}</textarea>
					</div>
				<br>
				<center>
				<button id="submit-parse" class="green">Create Gantt</button>
				&nbsp;
				<button id="submit-clear" onClick="window.location.reload()">Clear</button>
			  </center>
				<br>
					<div id="visualization" class="text-center"></div>
				<br>
				<!-- i>Open the Console in your browser's inspector tools to see results.</i-->
				<script>

				$(function()
				{
					$('#submit-parse').click(function()
					{
						var txt = $('#input').val();

						/** START: Codeblock for including Custom CSS **/
						var style = document.createElement('style')
						style.type = 'text/css'
						//style.innerHTML = '.vis-item.vis-dot {border-color: #F991A3; background-color: pink;font-size: 15pt;color: purple;box-shadow: 5px 5px 20px rgba(128,128,128, 0.5);}'
						style.innerHTML = $('#custom_css').val();
						document.getElementsByTagName('head')[0].appendChild(style)
						var chart_opts = document.createElement('div')
						chart_opts.type = 'html'
						chart_opts.innerHTML = '<div class="grid-35 text-center">'+'Axis orientation: <select id="axis-orientation">'+
						'<option value="both" selected>both</option>'+'<option value="bottom">bottom</option>'+'<option value="none">none</option>'+
						'<option value="top">top</option>'+'</select>'+'</div>'+'<div class="grid-35 text-center">'+'Tasks orientation: <select id="item-orientation">'+
						'<option value="bottom" selected>bottom</option>'+'<option value="top">top</option>'+'</select>'+'</div>'+'<div class="grid-30 text-center">'+
						'Axis Scale: <select id="timeaxis-scale">'+'<option value="year">Year'+'</option>'
						+'<option value="month" selected>Month'+'</option>'
						+'<option value="day">Day'+'</option>'
						+'<option value="weekday">Weekday'+'</option>'
						+'<option value="hour">Hour'+'</option>'
						+'<option value="minute">Minute'+'</option>'
						+'<option value="second">Second'+'</option>'
						+'<option value="millisecond">Millisecond'+'</option>'
					+'</select>'
				+'</div>'
						document.getElementById('visualization').appendChild(chart_opts)
						/** END: Codeblock for including Custom CSS **/

						//var tab2csv = txt.replace(/	/g, ",");
						//console.log(tab2csv);
						//var results = Papa.parse(tab2csv, {header: "TRUE",skipEmptyLines:"TRUE", Delimiter:"auto"});
						var results = Papa.parse(txt, {header: "TRUE",skipEmptyLines:"TRUE", Delimiter:"auto"});

		  			var items = new vis.DataSet();

						var groups = new vis.DataSet();

						// 1. Create the button
						var zoomin = document.createElement("button");
						zoomin.innerHTML = "+";

						// 2. Append to Gantt
						var body = document.getElementById('visualization');
						body.appendChild(zoomin);

						// 3. Add event handler
						zoomin.addEventListener ("click", function() {
						  //alert("Zoom In");
							timeline.zoomIn( 0.2);
						});

						// 1. Create the button
						var zoomout = document.createElement("button");
						zoomout.innerHTML = "-";

						// 2. Append to Gantt
						var body = document.getElementById('visualization');
						body.appendChild(zoomout);

						// 3. Add event handler
						zoomout.addEventListener ("click", function() {
						  //alert("Zoom Out");
							timeline.zoomOut( 0.2);
						});
/*End: Add Zoom button*/

							// create a timeline
		  			var container = document.getElementById('visualization');
		  			var options = {
								editable: true,
								//clickToUse: true,
								orientation: {axis:'both'}

		  				};
						 	/*console.log("----------------RESULT--------------");
							console.log(results.data);
							console.log("--------------------------------------");*/
/* START: fix for removing null or empty value from csv data in json*/
/*
This code block fixes null value for json to ensures that csv data in "" does not
get included in the resulting serialisation.

This is particularly important when group for a background item is empty and expectation
is that the task as bacground will span across all groups.

Basically this code block ensures that following csv:
						id,content,group,start,end,type,className
						2,Task 2,,2016-12-02,,box,green
results in following dataset:
[{"id":"2"},{"content":"Task2"},{"start":"2016-12-02"},{"type":"box"},{"className":"green"}]
*/
							var jsonObj = results.data;
							items.clear();
							$.each(jsonObj, function(key, value){
								var jsonobjchild = value;
								$.each(jsonobjchild, function(key,value){
									if (value === "" || value === null){
//									console.log(jsonobjchild[key]);
									delete jsonobjchild[key];
								}
								});
								items.add(jsonobjchild);
								});
/* END: fix for removing null or empty value from csv data in json*/
/*						console.log("------------Distinct Groups------------------");
						console.log(items.distinct('group'));
						console.log("--------------------------------------");
						console.log("------------ITEMS------------------");
						console.log(items);
						console.log("--------------------------------------"); */

						groups.clear();
						$.each(items.distinct('group'), function(key,value){
						groups.add(
							{
								id: items.distinct('group')[key],
								content: items.distinct('group')[key],
								style: 'font-weight:bold'
							});
						});
						/*console.log("------------Groups------------------");
						console.log(groups);
						console.log(groups.length);
						console.log("--------------------------------------");*/

						if (groups.length == 0) {
						var timeline = new vis.Timeline(container, items, options);
						//console.log(groups.length);
						} else {
						var timeline = new vis.Timeline(container, items, groups, options);
						//console.log("in else loop")
						}
						timeline.fit();

						var axisOrientation = document.getElementById('axis-orientation');
					  axisOrientation.onchange = function () {
					    timeline.setOptions({ orientation: {axis: this.value} });
					  };

					  var itemOrientation = document.getElementById('item-orientation');
					  itemOrientation.onchange = function () {
					    timeline.setOptions({ orientation: {item: this.value} });
						};

						var timeaxisscale = document.getElementById('timeaxis-scale');
						timeaxisscale.onchange = function () {
					    timeline.setOptions({ timeAxis: {scale: this.value} });
						};
					});
				});
				</script>
			<!-- </div> -->
		</div>
		<footer>
			<div class="footer-main">
				<center>
				<img src="./img//DumatiLogo50x50.png">
				<br>
				Gantt Chart Creator by <a href="https://mgw.dumatics.com">Ankit Mittal</a>
			</center>
				<br>
			</div>
		</footer>
	</body>
</html>
